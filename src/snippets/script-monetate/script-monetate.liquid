{% if template == 'index' %}
  <script>
    window.monetateQ = window.monetateQ || [];
    window.monetateQ.push([
      "setPageType",
      "main"
    ]);
    
    window.monetateQ.push([
      "trackData"
    ]);
  </script>

{% elsif template == 'collection' %}
  <script>
    // Set Index Pagetype
    window.monetateQ = window.monetateQ || [];
    window.monetateQ.push([
      "setPageType",
      "index"
    ]);
    // Collect Product IDs
    var productIds = [];
    {% paginate collection.products by 10000 %}
      {% for product in collection.products %}
        var productId = {{ product.id }};
        productIds.push(productId);
      {% endfor %}
    {% endpaginate %}
  
    window.monetateQ.push([
      "addProducts", productIds
    ]);
    // Get Category Title, if set
    {% if collection.title %}
      var category = "{{ collection.title }}";
      window.monetateQ.push([ 
        "addCategories",
        [category]
      ]);
    {% endif %}

    window.monetateQ.push([
      "trackData"
    ]);
  </script>

{% elsif template == 'cart' %}
  {% if cart.item_count > 0 %}
    <script>
      // Set Cart Pagetype
      window.monetateQ = window.monetateQ || [];
      window.monetateQ.push([
        "setPageType",
        "cart"
      ]);
      // Collect Products in Cart
      var cart = [];
      {% for item in cart.items %}
        var productId = "{{ item.product_id }}";
        var sku = "{{ item.variant_id }}";
        var cartRow = {
          "productId": productId,
          "sku": sku,
          "quantity": {{ item.quantity }},
          "unitPrice": {{ item.price | money_without_currency | replace: ',', '' }},
          "currency": Shopify.currency.active
        };
        cart.push(cartRow);
      {% endfor %}

      window.monetateQ.push([
        "addCartRows",
        cart
      ]);
      window.monetateQ.push([
      "trackData"
      ]);
    </script>
  {%- endif -%}

{% elsif template == 'search' %}
  <script>
    // Set Search Pagetype
    window.monetateQ = window.monetateQ || [];
    window.monetateQ.push([
      "setPageType",
      "search"
    ]);
    // Collect Product IDs
    var productIds = [
      {% for item in search.results %}
        {{ item.id }},
      {% endfor %}
    ];

    window.monetateQ.push([
      "addProducts", productIds
    ]);
    window.monetateQ.push([
      "trackData"
    ]);
  </script>

{% elsif template == 'product' %}
  <script>
    // Set Product Pagetype
    window.monetateQ = window.monetateQ || [];
    window.monetateQ.push([
      "setPageType",
      "product"
    ]);
    // Collect Product Details
    var monetateProduct = {
      "productId": "{{ product.id }}",
      "sku": "{{ product.variants[0].sku }}"
    };
    window.monetateQ.push([
      "addProductDetails", [
        monetateProduct
      ]
    ]);
  
    {%- if collection.title -%}
      window.monetateQ.push([
        "addCategories",
        ["{{ collection.title }}"]
      ]);
    {%- endif -%}
        
    window.monetateQ.push([
      "trackData"
    ]);
    
    document.querySelector('.product-form__submit').addEventListener('click', function () {
      window.monetateQ = window.monetateQ || [];
      window.monetateQ.push([
        "setPageType",
        "product"
      ]);
      // Collect Product Details
      var monetateProduct = {
        "productId": "{{ product.id }}",
        "sku": "{{ product.variants[0].sku }}"
      };
      window.monetateQ.push([
        "addProductDetails", [
          monetateProduct
        ]
      ]);
      
      {%- if collection.title -%}
      window.monetateQ.push([
        "addCategories",
        ["{{ collection.title }}"]
      ]);
      {%- endif -%}
      
      window.monetateQ.push([
      "trackData"
      ]);
    })
  </script>
{% endif %}