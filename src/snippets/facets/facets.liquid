{% comment %}
    Renders facets (filtering and sorting)

    Accepts:
    - results: {Object} Collection or Search object
    - enable_filtering: {Boolean} Show filtering when true
    - enable_sorting: {Boolean} Show sorting when true
    - collapse_on_larger_devices: {Boolean} Collapse filtering/sorting into menu on larger devices when true

    Usage:
    {% render 'facets', results: collection, enable_filtering: true, enable_sorting: true, collapse_on_larger_devices: false %}
{% endcomment %}

{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  assign total_active_values = 0
  if results.url
    assign results_url = results.url
  else 
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
-%}

{%- if show_breadcrumb -%}
  <div class="page-width">
    {% render 'breadcrumbs' %}
  </div>
{%- endif -%}


<div class="page-width facets-container" data-id="{{ section.id }}">
  {% if filter_by_size %}
    <facet-filters-form class="facets">
      <form id="FacetFiltersFormSize" class="facets__form">
        {%- if results.terms -%}
          <input type="hidden" name="q" value="{{ results.terms | escape }}">
          <input name="options[prefix]" type="hidden" value="last">
        {%- endif -%}
        {%- for filter in results.filters -%}
          {% case filter.type %}
          {% when 'list' %}
            {% if filter.label == 'Size' %}
              <div class="mobile-facets__details js-filter small-hide" data-index="mobileSize-{{ forloop.index }}">
                <h2 class="facets__summary">
                  <span>{{ 'sections.collection_template.sort_by_size' | t }}</span>
                </h2>
                <ul class="mobile-facets__list list-unstyled" role="list" data-type="{{ filter.label | downcase }}" aria-label="Activating any of the checkboxes will update the content: {{ 'sections.collection_template.sort_by_size' | t }}">
                  {%- for value in filter.values -%}
                    {% assign forloop_index = forloop.index %}
                    {% assign values = value.value | split: ',' %}
                    {% for value_name in values %}
                      <li class="mobile-facets__item list-menu__item {% if value.count == 0 and value.active == false %}filter-soldout{% endif %}">
                        <div class="item" title="{{ value_name | escape }}" class="mobile-facets__label">
                          <input
                            id="Filter-{{ filter.label | escape }}-mobile-{{ forloop_index }}-{{forloop.index}}"
                            type="checkbox"
                            name="{{ value.param_name }}"
                            value="{{ value.value }}"
                            data-position="{{forloop.index}}"
                            class="mobile-facets__checkbox"
                            aria-label="filter for {{ 'sections.collection_template.sort_by_size' | t }} {{ value.value }}"
                            aria-checked="{% if value.active %}true{% else %}false{% endif %}"
                            {% if value.active %}checked{% endif %}
                            {% if value.count == 0 and value.active == false %}disabled{% endif %}
                            tabindex="0"
                          >
                          <label
                            for="Filter-{{ filter.label | escape }}-mobile-{{ forloop_index }}-{{forloop.index}}"
                            class="mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}"
                            role="button"
                            title="Size {{ value.value }} {% if value.active %}selected{% endif %}"
                          >
                            {{ value.value }}
                          </label>
                        </div>
                      </li>
                    {%- endfor -%}
                  {%- endfor -%}
                  {%- if enable_sorting -%}
                    <li class="mobile-facets__item clear-all active">
                      <facet-remove class="active-facets__button-wrapper">
                        <a href="{{ results_url }}?sort_by={{ sort_by }}" class="active-facets__button-remove underlined-link">
                          <span>{{ 'sections.collection_template.all_sizes' | t }}</span>
                        </a>
                      </facet-remove>
                    </li>
                  {%- endif -%}
                </ul>
              </div>
            {% else %}
              <div class="mobile-facets__details js-filter hidden" data-index="mobileSize-{{ forloop.index }}">
                <h2 class="facets__summary">
                  <span tabindex="0">{{ 'sections.collection_template.sort_by_size' | t }}</span>
                </h2>
                <ul class="facets__list list-unstyled" role="list" data-type="{{ filter.label | downcase }}">
                  {%- for value in filter.values -%}
                    <li class="list-menu__item facets__item">
                      <label for="Filter-{{ filter.label | escape }}-{{ forloop.index }}" class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}" tabindex="0">
                        <input type="checkbox"
                          name="{{ value.param_name }}"
                          value="{{ value.value }}"
                          id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                          {% if value.active %}checked{% endif %}
                          {% if value.count == 0 and value.active == false %}disabled{% endif %}
                        >
                        <svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                          <rect width="16" height="16" stroke="currentColor" fill="none" stroke-width="1"></rect>
                        </svg>
                        <svg class="icon icon-checkmark"
                          width="11"
                          height="7"
                          viewBox="0 0 11 7"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg">
                          <path d="M1.5 3.5L2.83333 4.75L4.16667 6L9.5 1"
                            stroke="currentColor"
                            stroke-width="1.75"
                            stroke-linecap="round"
                            stroke-linejoin="round" />
                        </svg>
                        </svg>
                        {{ value.label | escape }}
                      </label>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {% endif %}
          {% endcase %}
        {%- endfor -%}
      </form>
    </facet-filters-form>
  {% endif %}
  {%- if enable_filtering or enable_sorting -%}
    {%- assign total_active_values = 0 -%}
    <menu-drawer class="mobile-facets__wrapper {% if collapse_on_larger_devices == false and sidebar_on_larger_devices == false %} medium-hide large-up-hide{% endif %}{% if sidebar_on_larger_devices %} medium-hide large-up-hide{% endif %}" data-breakpoint="mobile">
      <details class="mobile-facets__disclosure disclosure-has-popup">
        <summary class="mobile-facets__open-wrapper focus-offset">
          <span tabindex="0" class="mobile-facets__close mobile-facets__close--no-js">{%- render 'icon-close' -%}</span>
        </summary>
        <facet-filters-form>
          <form id="FacetFiltersFormMobile" class="mobile-facets">
            {%- if results.terms -%}
              <input type="hidden" name="q" value="{{ results.terms | escape }}">
              <input name="options[prefix]" type="hidden" value="last">
            {%- endif -%}
            <div class="mobile-facets__inner">
              <div class="mobile-facets__header">
                <div class="mobile-facets__header-inner">
                  <h2 class="mobile-facets__heading">{{ 'sections.collection_template.filter_and_sort' | t }}</h2>
                  {%- if results.results_count -%}
                    {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
                  {%- elsif results.products_count == results.all_products_count -%}
                    {{ 'sections.collection_template.product_count_simple' | t: count: results.products_count }}
                  {%- else -%}
                    {{ 'sections.collection_template.product_count' | t: product_count: results.products_count, count: results.all_products_count }}
                  {%- endif -%}
                </div>
              </div>
              <div class="mobile-facets__main">
                {%- for filter in results.filters -%}
                  {% case filter.type %}
                  {% when 'list' %}
                    <details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}" data-type="{{ filter.label | escape }}">
                      <summary class="mobile-facets__summary focus-inset">
                        <div>
                          {% if filter.label == 'Product type' %}
                            <h2>{{ 'products.product.categories' | t }}</h2>
                          {% else %}
                            <h2>{{ filter.label | escape }}</h2> 
                          {% endif %}
                          <div class="facets__header">
                            <span class="facets__selected no-js-hidden" data-value="{{ filter.active_values.size }}">({{ filter.active_values.size }})</span>
                          </div>
                          <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-plus' %}{% render 'icon-minus' %}</span>
                          <noscript>{% render 'icon-caret' %}</noscript>
                        </div>
                      </summary>
                      <div class="mobile-facets__submenu">
                        <ul class="mobile-facets__list list-unstyled" role="list" data-type="{{ filter.label | downcase }}" aria-label="Activating any of the checkboxes will update the content: {{ filter.label }}">
                          {%- for value in filter.values -%}
                            {% assign forloop_index = forloop.index %}
                            {% assign values = value.value | split: ',' %}
                            {% for value_name in values %}
                              <li class="mobile-facets__item list-menu__item {% if value.count == 0 and value.active == false %}filter-soldout{% endif %}">
                                <label for="Filter-{{ filter.label | escape }}-mobile-{{ forloop_index }}-{{forloop.index}}" class="mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}">
                                  <input 
                                    class="mobile-facets__checkbox" 
                                    type="checkbox" 
                                    name="{{ value.param_name }}" 
                                    value="{{ value.value }}" 
                                    id="Filter-{{ filter.label | escape }}-mobile-{{ forloop_index }}-{{forloop.index}}"
                                    aria-label="filter for {{ filter.label | escape }} {{ value.value }}"
                                    aria-checked="{% if value.active %}true{% else %}false{% endif %}"
                                    {% if value.active %}checked{% endif %}
                                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                                  >
                                  <span class="mobile-facets__highlight"></span>
                                  <svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                                    <rect width="16" height="16" stroke="currentColor" fill="none" stroke-width="1"></rect>
                                  </svg>
                                  <svg class="icon icon-checkmark" width="11" height="7" viewBox="0 0 11 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1.5 3.5L2.83333 4.75L4.16667 6L9.5 1" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" />
                                  </svg>
                                  {% if show_color_on_filter_color %}
                                    {% if filter.label == 'Color' or filter.label == 'Cor' %}
                                      <div class="color-swatch {{ value_name | escape | handleize | strip }}"></div>
                                    {% endif %}
                                  {% endif %}
                                  {{ value_name | escape }}
                                </label>
                              </li>
                            {%- endfor -%}
                          {%- endfor -%}
                        </ul>
                        <div class="no-js-hidden mobile-facets__footer">
                          <facet-remove class="mobile-facets__clear-wrapper">
                            <a href="{{ results_url }}" class="mobile-facets__clear underlined-link">{{ 'sections.collection_template.clear' | t }}</a>
                          </facet-remove>
                          <button type="button" class="no-js-hidden button button--primary" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'sections.collection_template.apply' | t }}</button>
                          <noscript><button class="button button--primary">{{ 'sections.collection_template.apply' | t }}</button></noscript>
                        </div>
                      </div>
                    </details>
                  {% when 'price_range' %}
                    <details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
                      <summary class="mobile-facets__summary focus-inset">
                        <div>
                          <h2>{{ filter.label | escape }}</h2>
                          <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-plus' %}{% render 'icon-minus' %}</span>
                          <noscript>{% render 'icon-caret' %}</noscript>
                        </div>
                      </summary>
                      <div class="mobile-facets__submenu">
                        <p class="mobile-facets__info hidden">{{ "sections.collection_template.max_price" | t: price: max_price_amount }}</p>
                        <div class="slider-price">
                          <div class="multi-range-slider">
                            <input class="range__price-min" 
                              type="range" 
                              id="Mobile-Filter-range-{{ filter.label | escape }}-GTE" 
                              min="0" 
                              max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                              {%- if filter.min_value.value -%}
                                {%- if uses_comma_decimals -%}value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                              {% else %}
                                value="0"
                              {%- endif -%}
                            >
                            <input class="range__price-max"
                              type="range" 
                              id="Mobile-Filter-range-{{ filter.label | escape }}-LTE" 
                              min="0" 
                              max="{{ filter.range_max | money_without_currency | replace: ',', '' }}" 
                              {%- if filter.max_value.value -%}
                                {%- if uses_comma_decimals -%}
                                  value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                          {%- else -%}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                                {% endif %}
                              {% else %}
                                value="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                              {%- endif -%}
                            >
                            <div class="slider">
                              <div class="track"></div>
                              <div class="range"></div>
                              <div class="thumb left"></div>
                              <div class="thumb right"></div>
                            </div>
                          </div>
                        </div>
                        <price-range class="facets__price">
                          <div class="field">
                            <span class="field-currency field__label">{{ cart.currency.symbol }}</span>
                            <input class="field__input input__price-min"
                              name="{{ filter.min_value.param_name }}"
                              id="Mobile-Filter-input-{{ filter.label | escape }}-GTE"
                              {%- if filter.min_value.value -%}
                                {%- if uses_comma_decimals -%}value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                              {%- endif -%}
                              type="number"
                              placeholder="0"
                              min="0"
                              inputmode="decimal"
                              {%- if uses_comma_decimals -%}max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"{% endif %}
                            >
                            </input>
                          </div>
                          <span class="field-price-to">{{ 'sections.collection_template.to' | t }}</span>
                          <div class="field">
                            <span class="field-currency field__label">{{ cart.currency.symbol }}</span>
                            <input class="field__input input__price-max"
                              name="{{ filter.max_value.param_name }}"
                              id="Mobile-Filter-input-{{ filter.label | escape }}-LTE"
                              {%- if filter.max_value.value -%}
                                {%- if uses_comma_decimals -%}value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                              {%- endif -%}
                              type="number"
                              min="0"
                              inputmode="decimal"
                              {%- if uses_comma_decimals -%}
                                placeholder="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                              {%- else -%}
                                placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                              {% endif %}
                            >
                            </input>
                          </div>
                        </price-range>
                        <div class="no-js-hidden mobile-facets__footer">
                          <facet-remove class="mobile-facets__clear-wrapper">
                            <a href="{{ results_url }}" class="mobile-facets__clear underlined-link">{{ 'sections.collection_template.clear' | t }}</a>
                          </facet-remove>
                          <button type="button" class="no-js-hidden button button--primary" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'sections.collection_template.apply' | t }}</button>
                          <noscript><button class="button button--primary">{{ 'sections.collection_template.apply' | t }}</button></noscript>
                        </div>
                      </div>
                    </details>
                  {% endcase %}
                {%- endfor -%}
                {%- if enable_sorting -%}
                  <div class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}" style="background-color: red;">
                    <div class="mobile-facets__details mobile-facets__summary">
                      <div class="mobile-facets__sort">
                        <label for="SortBy-mobile">{{ 'sections.collection_template.sort_by_label' | t }}</label>
                        <div class="select">
                          <select name="sort_by" class="select__select" id="SortBy-mobile" aria-describedby="a11y-refresh-page-message" tabindex="0">
                            {%- for option in results.sort_options -%}
                              <option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
                            {%- endfor -%}
                          </select>
                          {% render 'icon-caret' %}
                        </div>
                      </div>
                    </div>
                  </div>
                {%- endif -%}
                <div class="mobile-facets__footer">
                  <facet-remove class="mobile-facets__clear-wrapper">
                    <a href="{{ results_url }}" class="mobile-facets__clear underlined-link">{{ 'sections.collection_template.clear_all' | t }}</a>
                  </facet-remove>
                  <button type="button" class="no-js-hidden button button--primary" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'sections.collection_template.apply' | t }}</button>
                  <noscript><button class="button button--primary">{{ 'sections.collection_template.apply' | t }}</button></noscript>
                </div>
              </div>
              {% if results.current_vendor or results.current_type %}
                <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
              {% endif %}
            </div>
          </form>
        </facet-filters-form>
      </details>
    </menu-drawer>
    <div class="active-facets active-facets-mobile {% if collapse_on_larger_devices == false and sidebar_on_larger_devices == false %} medium-hide large-up-hide{% endif %}">
      {%- for filter in results.filters -%}
        {%- for value in filter.active_values -%}
          <facet-remove data-value="{{ value.label | handle }}">
            <a href="{{ value.url_to_remove }}" class="active-facets__button active-facets__button--light">
              <span class="active-facets__button-inner button button--tertiary">
                {{ value.label | escape }}
                {% render 'icon-close-small' %}
              </span>
            </a>
          </facet-remove>
        {%- endfor -%}
        {%- if filter.type == "price_range" -%}
          {%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
            <facet-remove>
              <a href="{{ filter.url_to_remove }}" class="active-facets__button active-facets__button--light">
                <span class="active-facets__button-inner button button--tertiary">
                  {%- if filter.min_value.value -%}{{ filter.min_value.value | money }}{%- else -%}{{ 0 | money }}{%- endif -%}-{%- if filter.max_value.value -%}{{ filter.max_value.value | money }}{%- else -%}{{ filter.range_max | money }}{%- endif -%}
                  {% render 'icon-close-small' %}
                </span>
              </a>
            </facet-remove>
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
      <facet-remove class="active-facets__button-wrapper">
        <a href="{{ results_url }}" class="active-facets__button-remove underlined-link">
          <span>{{ 'sections.collection_template.clear_all' | t }}</span>
        </a>
      </facet-remove>
    </div>
    <div class="collection-product-count light{% if collapse_on_larger_devices == false and sidebar_on_larger_devices == false %} medium-hide large-up-hide{% endif %}" role="status">
      <p id="FacetProductCount" class="collection-product-count__text {% unless enable_product_count %}hidden{% endunless %}">
        {%- if results.results_count -%}
          {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
        {%- elsif results.products_count == results.all_products_count -%}
          {{ 'sections.collection_template.product_count_simple' | t: count: results.products_count }}
        {%- else -%}
          {{ 'sections.collection_template.product_count' | t: product_count: results.products_count, count: results.all_products_count }}
        {%- endif -%}
      </p>
      <div class="loading-overlay__spinner">
        <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
        </svg>
      </div>
    </div>
  {%- endif -%}
</div>
{% if sidebar_on_larger_devices %}
  <div class="sidebar-filter page-width open-filters">
    <div class="mobile-facets__main">
      <menu-drawer class="mobile-facets__wrapper">
        <facet-filters-form>
          <form >
            {%- if results.terms -%}
              <input type="hidden" name="q" value="{{ results.terms | escape }}">
              <input name="options[prefix]" type="hidden" value="last">
            {%- endif -%}
            <ul id="FacetFiltersFormSidebar">
              {%- for filter in results.filters -%}
                {% case filter.type %}
                  <span>{{filter.type}}</span>
                  {{filter}}
                  {% when 'list' %}
                    <li class="mobile-facets__details js-filter" data-index="sidebar-{{ forloop.index }}" data-type="{{ filter.label | escape }}">
                      <details>
                        <summary class="mobile-facets__summary focus-inset">
                          <div>
                            {% if filter.label == 'Product type' %}
                              <h2>{{ 'products.product.categories' | t }}</h2> 
                            {% else %}
                              <h2>{{ filter.label | escape }}</h2> 
                            {% endif %}
                            <div class="facets__header">
                              <span class="facets__selected no-js-hidden" data-value="{{ filter.active_values.size }}">({{ filter.active_values.size }})</span>
                            </div>
                            <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-plus' %}{% render 'icon-minus' %}</span>
                            <noscript>{% render 'icon-caret' %}</noscript>
                          </div>
                        </summary>
                        <div class="mobile-facets__submenu">
                          <ul class="mobile-facets__list list-unstyled" role="list" data-type="{{ filter.label | downcase }}" aria-label="Activating any of the checkboxes will update the content: {{ filter.label }}">
                            {%- for value in filter.values -%}
                              {% assign forloop_index = forloop.index %}
                              {% assign values = value.value | split: ',' %}                        
                                {% for value_name in values %}
                                  <li class="mobile-facets__item list-menu__item {% if value.count == 0 and value.active == false %}filter-soldout{% endif %}">
                                    <label for="Filter-{{ filter.label | escape }}-sidebar-{{ forloop_index }}-{{forloop.index}}" class="mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}">
                                      <input 
                                        class="mobile-facets__checkbox" 
                                        type="checkbox" 
                                        name="{{ value.param_name }}" 
                                        value="{{ value.value }}" 
                                        id="Filter-{{ filter.label | escape }}-sidebar-{{ forloop_index }}-{{forloop.index}}"
                                        aria-label="filter for {{ filter.label | escape }} {{ value.value }}"
                                        aria-checked="{% if value.active %}true{% else %}false{% endif %}"
                                        {% if value.active %}checked{% endif %}
                                        {% if value.count == 0 and value.active == false %}disabled{% endif %}
                                      >
                                      <span class="mobile-facets__highlight"></span>
                                      <svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                                        <rect width="16" height="16" stroke="currentColor" fill="none" stroke-width="1"></rect>
                                      </svg>
                                      <svg class="icon icon-checkmark" width="11" height="7" viewBox="0 0 11 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1.5 3.5L2.83333 4.75L4.16667 6L9.5 1" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" />
                                      </svg>
                                      {% if show_color_on_filter_color %}
                                        {% if filter.label == 'Color' or filter.label == 'Cor' %}
                                          <div class="color-swatch {{ value_name | escape | handleize | strip }}"></div>
                                        {% endif %}
                                      {% endif %}
                                      {{ value_name | strip | escape }}
                                    </label>
                                  </li>
                                {% endfor %}
                            {%- endfor -%}
                            {% if show_limited_filters and filter.label != 'Size' and filter.values.size > 5 %}
                              <a class="show-more-filters show-more" href="#" data-limit="{{ number_limited_filters }}">
                                <span class="more">{{ 'sections.collection_template.show_more' | t }}</span>
                                <span class="less">{{ 'sections.collection_template.show_less' | t }}</span>
                              </a>
                            {% endif %}
                          </ul>
                        </div>
                      </details>
                    </li>
                  {% when 'price_range' %}
                    <li>
                      <details class="mobile-facets__details js-filter" data-index="sidebar-{{ forloop.index }}">
                        <summary class="mobile-facets__summary focus-inset" tabindex="0">
                          <div>
                            <h2>{{ filter.label | escape }}</h2>
                            <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-plus' %}{% render 'icon-minus' %}</span>
                            <noscript>{% render 'icon-caret' %}</noscript>
                          </div>
                        </summary>
                        <div class="mobile-facets__submenu">
                          <p class="mobile-facets__info hidden">{{ "sections.collection_template.max_price" | t: price: max_price_amount }}</p>

                          <div class="slider-price">
                            <div class="multi-range-slider">
                              <input class="range__price-min" 
                                type="range" 
                                id="Mobile-Filter-range-{{ filter.label | escape }}-GTE" 
                                min="0" 
                                max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                {%- if filter.min_value.value -%}
                                  {%- if uses_comma_decimals -%}value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                                {% else %}
                                  value="0"
                                {%- endif -%}
                                tabindex="0"
                              >
                              <input class="range__price-max"
                                type="range" 
                                id="Mobile-Filter-range-{{ filter.label | escape }}-LTE" 
                                min="0" 
                                max="{{ filter.range_max | money_without_currency | replace: ',', '' }}" 
                                {%- if filter.max_value.value -%}
                                  {%- if uses_comma_decimals -%}value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                                {% else %}
                                  value="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                {%- endif -%}
                                tabindex="0"
                              >
                          
                              <div class="slider">
                                <div class="track"></div>
                                <div class="range"></div>
                                <div class="thumb left"></div>
                                <div class="thumb right"></div>
                              </div>
                            </div>
                          </div>

                          <price-range class="facets__price">
                            <div class="field">
                              <span class="field-currency field__label">{{ cart.currency.symbol }}</span>
                              <input class="field__input input__price-min"
                                name="{{ filter.min_value.param_name }}"
                                id="Mobile-Filter-input-{{ filter.label | escape }}-GTE"
                                {%- if filter.min_value.value -%}
                                  {%- if uses_comma_decimals -%}value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                                {%- endif -%}
                                type="number"
                                placeholder="0"
                                min="0"
                                inputmode="decimal"
                                {%- if uses_comma_decimals -%}max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"{% endif %}
                                tabindex="0"
                              >
                              </input>
                            </div>

                            <span class="field-price-to">{{ 'sections.collection_template.to' | t }}</span>

                            <div class="field">
                              <span class="field-currency field__label">{{ cart.currency.symbol }}</span>
                              <input class="field__input input__price-max"
                                name="{{ filter.max_value.param_name }}"
                                id="Mobile-Filter-input-{{ filter.label | escape }}-LTE"
                                {%- if filter.max_value.value -%}
                                  {%- if uses_comma_decimals -%}value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                                {%- endif -%}
                                type="number"
                                min="0"
                                inputmode="decimal"
                                {%- if uses_comma_decimals -%}
                                  placeholder="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                  max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                {%- else -%}
                                  placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                  max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                {% endif %}
                                tabindex="0"
                              >
                              </input>
                            </div>
                          </price-range>
                        </div>
                      </details>
                    </li>
                {% endcase %}
              {%- endfor -%}
              {%- if enable_sorting -%}
                <li>
                  <div class="mobile-facets__details js-filter sort-by" data-index="sidebar-{{ forloop.index }}">
                    <div class="mobile-facets__summary">
                      <div class="mobile-facets__sort">
                        <label for="SortBy-mobile">{{ 'sections.collection_template.sort_by_label' | t }}</label>
                        <div class="select">
                          <select name="sort_by" class="select__select" id="SortBy-mobile" aria-describedby="a11y-refresh-page-message" tabindex="0">
                            {%- for option in results.sort_options -%}
                              <option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
                            {%- endfor -%}
                          </select>
                          {% render 'icon-caret' %}
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
              {%- endif -%}
            </ul>
          </form>
        </facet-filters-form>
      </menu-drawer>
    </div>
{% endif %}

<script>
  function onResize() {
    var isMobile = window.matchMedia("(max-width: 750px)")?.matches;
    var newElm = document.querySelector(".facets-container");
    if (!newElm) return;
    var parentElm = document.querySelector(".open-filters");
    if (!parentElm) return;
    var childElm = parentElm.querySelector(".mobile-facets__main");
    if (!childElm) return;
    if (isMobile) {
      childElm.parentNode.insertBefore(newElm, childElm.nextSibling);
    } else {
      parentElm.parentNode.insertBefore(newElm, parentElm);
    }
  };

  window.addEventListener('resize', onResize);
  onResize();
</script>